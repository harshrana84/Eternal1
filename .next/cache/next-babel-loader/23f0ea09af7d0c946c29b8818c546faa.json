{"ast":null,"code":"function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport { useState, useEffect } from 'react';\nimport localForage from 'localforage';\nconst isObjectLiked = value => value.constructor.name === 'Array' || value.constructor.name === 'Object';\nconst rehydrate = (value, defaultValue) => {\n  if (!value) return defaultValue;\n  // if (value === 'false') str = false;\n  // if (value === 'true') str = true;\n  if (isObjectLiked(value)) {\n    return value;\n  }\n  try {\n    const parse = JSON.parse(value);\n    return parse;\n  } catch (err) {\n    return defaultValue;\n  }\n};\nconst hydrate = value => {\n  if (!isObjectLiked(value)) {\n    return value;\n  }\n  return JSON.stringify(value);\n};\nconst createMigration = (opts, data) => {\n  return new Promise((resolve, reject) => {\n    const key = `${opts.key}-version`;\n    localForage.getItem(key, (err, version) => {\n      if (version !== opts.version) {\n        data = opts.migrate(data);\n        localForage.setItem(opts.key, rehydrate(data), err => {\n          if (err) return reject(err);\n          localForage.setItem(key, opts.version, err => {\n            if (err) return reject(err);\n            return resolve(data);\n          });\n        });\n      } else {\n        resolve(data);\n      }\n    });\n  });\n};\nconst config = {\n  key: '@session-medsy',\n  version: 1,\n  migrate: state => {\n    return _objectSpread({}, state);\n  }\n};\nexport const useStorage = (state, setState) => {\n  const {\n    0: rehydrated,\n    1: setRehydrated\n  } = useState(false);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  useEffect(() => {\n    async function init() {\n      await localForage.getItem(config.key, (err, value) => {\n        if (err) {\n          setRehydrated(true);\n          return setError(err);\n        }\n        // Migrate persisted data\n        const restoredValue = rehydrate(value);\n        if (typeof config.migrate === 'function') {\n          createMigration(config, restoredValue).then(data => setState(data)).then(() => setRehydrated(true));\n        } else {\n          setState(restoredValue);\n          setRehydrated(true);\n        }\n      });\n    }\n    init();\n  }, []);\n  useEffect(() => {\n    // if (isNil(state) || isEmpty(state)) {\n    //   localForage.removeItem(config.key);\n    // }\n    localForage.setItem(config.key, hydrate(state));\n  }, [state]);\n  return {\n    rehydrated,\n    error\n  };\n};","map":{"version":3,"names":["useState","useEffect","localForage","isObjectLiked","value","constructor","name","rehydrate","defaultValue","parse","JSON","err","hydrate","stringify","createMigration","opts","data","Promise","resolve","reject","key","getItem","version","migrate","setItem","config","state","_objectSpread","useStorage","setState","rehydrated","setRehydrated","error","setError","init","restoredValue","then"],"sources":["C:/Photoshop2021x64/Github Repo/Eternal/src/helpers/use-storage.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport localForage from 'localforage';\nconst isObjectLiked = (value) =>\n  value.constructor.name === 'Array' || value.constructor.name === 'Object';\n\nconst rehydrate = (value: any, defaultValue?: any) => {\n  if (!value) return defaultValue;\n  // if (value === 'false') str = false;\n  // if (value === 'true') str = true;\n  if (isObjectLiked(value)) {\n    return value;\n  }\n  try {\n    const parse = JSON.parse(value);\n    return parse;\n  } catch (err) {\n    return defaultValue;\n  }\n};\n\nconst hydrate = (value) => {\n  if (!isObjectLiked(value)) {\n    return value;\n  }\n  return JSON.stringify(value);\n};\nconst createMigration = (opts, data) => {\n  return new Promise((resolve, reject) => {\n    const key = `${opts.key}-version`;\n    localForage.getItem(key, (err, version) => {\n      if (version !== opts.version) {\n        data = opts.migrate(data);\n        localForage.setItem(opts.key, rehydrate(data), (err) => {\n          if (err) return reject(err);\n          localForage.setItem(key, opts.version, (err) => {\n            if (err) return reject(err);\n            return resolve(data);\n          });\n        });\n      } else {\n        resolve(data);\n      }\n    });\n  });\n};\n\nconst config = {\n  key: '@session-medsy',\n  version: 1,\n  migrate: (state) => {\n    return { ...state };\n  },\n};\n\nexport const useStorage = (state, setState) => {\n  const [rehydrated, setRehydrated] = useState(false);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    async function init() {\n      await localForage.getItem(config.key, (err, value) => {\n        if (err) {\n          setRehydrated(true);\n          return setError(err);\n        }\n        // Migrate persisted data\n        const restoredValue = rehydrate(value);\n        if (typeof config.migrate === 'function') {\n          createMigration(config, restoredValue)\n            .then((data) => setState(data))\n            .then(() => setRehydrated(true));\n        } else {\n          setState(restoredValue);\n          setRehydrated(true);\n        }\n      });\n    }\n    init();\n  }, []);\n\n  useEffect(() => {\n    // if (isNil(state) || isEmpty(state)) {\n    //   localForage.removeItem(config.key);\n    // }\n    localForage.setItem(config.key, hydrate(state));\n  }, [state]);\n\n  return {\n    rehydrated,\n    error,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}